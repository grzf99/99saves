machine:
  node:
    version: 7.9.0
database:
  override:
    - NODE_ENV=test-ci npm run sequelize db:migrate
test:
  pre:
    - mv .env.sample .env
  override:
    - echo "true"
deployment:
  production:
    tag: /(V|v)-[0-9]+(\.[0-9]+)*/
    heroku:
      appname: saves99
    commands:
      - heroku pg:backups capture --app saves99
  staging:
    branch: master
    commands:
      - "[[ ! -s \"$(git rev-parse --git-dir)/shallow\" ]] || git fetch --unshallow"
      - heroku pg:backups capture --app saves99-staging
      - heroku run sequelize db:migrate --app saves99-staging
      - git push git@heroku.com:saves99-staging.git $CIRCLE_SHA1:refs/heads/master
